var __sebAnalytics = function() {
    function x() {
        var a = navigator.userAgent.toLowerCase();
        return -1 != a.indexOf("msie") ? parseInt(a.split("msie")[1]) : !1
    }
    function g() {
        return (65536 * (1 + Math.random()) | 0).toString(16).substring(1)
    }
    function u() {
        return g() + g() + "-" + g() + "-" + g() + "-" + g() + "-" + g() + g() + g()
    }
    function p(a) {
        if ("[object Object]" === Object.prototype.toString.call(a)) {
            var b = {}, c;
            for (c in a)
                b[c] = p(a[c]);
            return b
        }
        if ("[object Array]" === Object.prototype.toString.call(a)) {
            var b = [], e;
            for (e in a)
                b.push(p(a[e]));
            return b
        }
        return a
    }
    function G() {
        var a = {
            userAgent: navigator.userAgent ? navigator.userAgent : "",
            language: navigator.language ? navigator.language : "",
            doNotTrack: navigator.doNotTrack ? navigator.doNotTrack : "",
            cookieEnabled: navigator.cookieEnabled ? navigator.cookieEnabled : "",
            platform: navigator.platform ? navigator.platform : "",
            navigator: {
                appCodeName: navigator.appCodeName ? navigator.appCodeName : "",
                appName: navigator.appName ? navigator.appName : "",
                appVersion: navigator.appVersion ? navigator.appVersion : "",
                buildID: navigator.buildID ? navigator.buildID : ""
            },
            sizes: {
                screen: {
                    width: screen.width,
                    height: screen.height,
                    colorDepth: screen.colorDepth,
                    pixelDepth: screen.pixelDepth
                },
                window: {
                    height: window.outerHeight,
                    width: window.outerWidth
                },
                document: {
                    height: window.innerHeight,
                    width: window.innerWidth
                }
            }
        };
        f.geoloc && navigator.geolocation && navigator.geolocation.getCurrentPosition(function(a) {
            m.context.position = {
                latitude: a.coords.latitude,
                longitude: a.coords.longitude,
                accuracy: a.coords.accuracy,
                altitude: a.coords.altitude,
                timestamp: a.coords.timestamp
            }
        });
        return a
    }
    function H() {
        var a = this
          , b = []
          , c = [];
        this.push = function(a) {
            if (f.devMode || "127.0.0.1" !== location.hostname && "localhost" !== location.hostname)
                b.push(a),
                y.notifyTimer()
        }
        ;
        this.shift = function() {
            if (b.length) {
                var a = {
                    events: []
                }, r = [], A;
                for (A in b) {
                    if (99 < a.events.length)
                        break;
                    var h = !1, z = b[A], B;
                    for (B in c)
                        if (c[B].guid === z.guid) {
                            h = !0;
                            break
                        }
                    h || (r.push(z),
                    c.push(z),
                    h = p(z),
                    delete h.guid,
                    a.events.push(h))
                }
                if (0 < a.events.length) {
                    var g = function() {
                        for (var a in r) {
                            for (var e = r[a], d = b.length - 1; 0 <= d; d--)
                                b[d].guid === e.guid && b.splice(d, 1);
                            for (d = c.length - 1; 0 <= d; d--)
                                c[d].guid === e.guid && c.splice(d, 1)
                        }
                    }
                      , n = function() {
                        for (var a in r)
                            for (var e = r[a], d = c.length - 1; 0 <= d; d--)
                                b[d].guid === e.guid && c.splice(d, 1);
                        for (a = b.length - 1; 0 <= a; a--)
                            b[a].ssid !== m.ssid && b.splice(a, 1);
                        f.maxRetry--;
                        0 >= f.maxRetry ? y.stop() : y.wait(f.timeBetweenTries)
                    }
                      , l = function() {
                        var b = null;
                        if (window.XMLHttpRequest && !(x() && 10 > x()))
                            b = new XMLHttpRequest;
                        else if (window.ActiveXObject)
                            try {
                                b = new ActiveXObject("Msxml2.XMLHTTP")
                            } catch (c) {
                                b = new ActiveXObject("Microsoft.XMLHTTP")
                            }
                        for (var r in a.events)
                            a.events[r].cors = !1;
                        b.open(d.configuration.ajaxMethod, d.configuration.url + m.ssid, f.async);
                        if (f.async)
                            try {
                                b.onload = g,
                                b.onabort = n,
                                b.ontimeout = n,
                                b.onerror = n
                            } catch (A) {
                                b.onreadystatechange = function() {
                                    4 == b.readyState && (200 <= b.status && 300 > b.status ? g() : n())
                                }
                            }
                        b.setRequestHeader("Content-type", "text/plain");
                        try {
                            b.send(JSON.stringify(a)),
                            f.async || (200 <= b.status && 300 > b.status ? g() : n())
                        } catch (k) {
                            n()
                        }
                    }
                      , k = null;
                    if (window.XMLHttpRequest && !(x() && 10 > x()))
                        k = new XMLHttpRequest;
                    else if (window.ActiveXObject)
                        try {
                            k = new ActiveXObject("Msxml2.XMLHTTP")
                        } catch (q) {
                            k = new ActiveXObject("Microsoft.XMLHTTP")
                        }
                    k.open(d.configuration.ajaxMethod, d.configuration.url + m.ssid, f.async);
                    if (f.async)
                        try {
                            k.onload = g,
                            k.onabort = l,
                            k.ontimeout = n,
                            k.onerror = n
                        } catch (s) {
                            k.onreadystatechange = function() {
                                4 == k.readyState && (200 <= k.status && 300 > k.status ? g() : 0 == k.status ? l() : n())
                            }
                        }
                    k.setRequestHeader("Content-type", "application/json");
                    try {
                        k.send(JSON.stringify(a)),
                        f.async || (200 <= k.status && 300 > k.status ? g() : 0 == k.status ? l() : n())
                    } catch (t) {
                        l()
                    }
                }
            }
        }
        ;
        this.flush = function() {
            if (b.length || c.length) {
                var a = JSON.stringify(b);
                "undefined" != typeof localStorage && null != localStorage ? localStorage.setItem(q, a) : C(q)
            }
        }
        ;
        this.removeAllEvents = function() {
            if (b.length || c.length) {
                var a = b;
                b = [];
                c = [];
                D(q);
                return a
            }
            return []
        }
        ;
        this.queuedEvent = function() {
            return b
        }
        ;
        this.sendStore = function() {
            var b;
            "undefined" != typeof localStorage && null != localStorage ? (b = localStorage.getItem(q),
            localStorage.removeItem(q)) : (b = E(q),
            D(q));
            if (null != b && "undefined" != typeof b) {
                b = JSON.parse(b);
                for (var c in b)
                    a.push(b[c])
            }
        }
        ;
        I("submit", "form[seb-analytics=true]", function(a) {
            var b = a.target;
            a = b.getAttribute("element-type");
            var c = b.getAttribute("search-type"), b = b.querySelectorAll("input,textarea,select"), f = {}, h;
            for (h in b) {
                var g = b[h];
                g.value ? f[g.getAttribute("name")] = g.value : serialized[g.getAttribute("name")] || (f[g.getAttribute("name")] = g.value)
            }
            d.buildAndAddMappedEvent("SEARCH", [a, c, f])
        });
        setInterval(function() {
            if (!v.length || location.hash !== v[v.length - 1].hash) {
                var a = {
                    hash: location.hash,
                    date: (new Date).toISOString()
                };
                v.push(a)
            }
        }, 1E3);
        J(function() {
            d.buildAndAddMappedEvent("PAGEUNLOAD", [document.URL ? document.URL : null, document.referrer ? document.referrer : null, navigator.userAgent ? navigator.userAgent : null, f.element_type, f.element_id, F, v]);
            a.flush()
        });
        K(function() {
            a.sendStore();
            d.buildAndAddMappedEvent("PAGELOAD", [document.URL ? document.URL : null, document.referrer ? document.referrer : null, navigator.userAgent ? navigator.userAgent : null, f.element_type, f.element_id, F])
        });
        this.getQueueLength = function() {
            return b.length
        }
    }
    function K(a) {
        var b;
        document.addEventListener ? (b = document.createEvent("Event"),
        b.initEvent("__sebanalytics_load_event", !0, !1),
        document.addEventListener("__sebanalytics_load_event", a)) : document.attachEvent && (document.documentElement.initAnalytics = 0,
        document.documentElement.attachEvent("onpropertychange", function(b) {
            "initAnalytics" == b.propertyName && (a(),
            document.documentElement.detachEvent("onpropertychange", arguments.callee))
        }));
        "complete" === document.readyState ? setTimeout(function() {
            document.dispatchEvent(b)
        }, 500) : document.addEventListener ? document.addEventListener("DOMContentLoaded", function() {
            document.dispatchEvent(b)
        }) : document.attachEvent && document.attachEvent("onreadystatechange", function() {
            "interactive" !== document.readyState && "complete" !== document.readyState || document.documentElement.initAnalytics++
        })
    }
    function J(a) {
        window.addEventListener ? window.addEventListener("unload", a) : window.attachEvent("onunload", function() {
            a()
        })
    }
    function I(a, b, c) {
        var e = function(a) {
            var e;
            if (e = a.target)
                a: {
                    e = a.target;
                    var d = document.querySelectorAll(b), f;
                    for (f in d)
                        if (d[f] === e) {
                            e = !0;
                            break a
                        }
                    e = !1
                }
            e && c(a)
        };
        document.addEventListener ? document.addEventListener(a, e) : document.attachEvent("on" + a, e)
    }
    function C(a, b) {
        if (document.cookie) {
            for (var c = a + "=", e = document.cookie.split(";"), d = 0; d < e.length; d++)
                if (0 === e[d].trim().indexOf(c))
                    return e[d] = a + "=" + b,
                    document.cookie = e.join(";"),
                    !0;
            document.cookie += a + "=" + b + "; "
        } else
            document.cookie = a + "=" + b + ";";
        return !0
    }
    function D(a) {
        if (document.cookie) {
            a += "=";
            for (var b = document.cookie.split(";"), c = 0; c < b.length; c++)
                if (0 === b[c].trim().indexOf(a))
                    return b.splice(c, 1),
                    document.cookie = b.join(";"),
                    !0
        }
        return !1
    }
    function E(a) {
        if (document.cookie) {
            a += "=";
            for (var b = document.cookie.split(";"), c = 0; c < b.length; c++) {
                var e = b[c].trim();
                if (0 === e.indexOf(a))
                    return e.substring(a.length, e.length)
            }
        }
    }
    var d = {}, s = !1, t, h = {
        notInitialized: "__sebAnalytics is not initialized, did you call __sebAnalytics.init(datas)?\n",
        babInitParams: "Initialization failed, ssid or version invalid\n",
        badEventId: "Event id is unknown from seb analytics\n",
        badValuesEvent: "Value array doesn't match with its authorized values\n",
        badValue: "Value is not authorized: \n"
    };
    d.configuration = {
        url: "https://dev.receiver.analytics.groupe-seb.com/events/",
        ajaxMethod: "POST",
        timerDefault: 100
    };
    var f = {
        async: !0,
        geoloc: !1,
        element_type: null,
        element_id: null,
        maxRetry: 3,
        followDoNotTrackPolicy: !1,
        devMode: !1,
        timeBetweenTries: 2E3
    }
      , q = "seb_analytics_events"
      , F = u()
      , v = []
      , l = {}
      , m = {
        type: "",
        date: "",
        ssid: "",
        version: "",
        libVersion: "v0.4.6",
        cors: !0,
        user: {
            userid: "",
            anonymousid: function() {
                var a = ""
                  , a = "undefined" != typeof localStorage && null != localStorage ? localStorage.getItem("seb_analytics_guid") : E("seb_analytics_guid");
                a || (a = u(),
                "undefined" != typeof localStorage && null != localStorage ? localStorage.setItem("seb_analytics_guid", a) : C("seb_analytics_guid", a));
                return a
            }()
        },
        params: [],
        context: {}
    }
      , L = {
        name: "",
        value: ""
    }
      , w = {
        PAGELOAD: {
            authorized_param_names: "url referer user_agent element_type element_id uuid".split(" ")
        },
        PAGEUNLOAD: {
            authorized_param_names: "url referer user_agent element_type element_id uuid states_hashs".split(" ")
        },
        SEARCH: {
            authorized_param_names: ["search_el_type", "search_type", "search_content"]
        },
        CONTENTLOAD: {
            authorized_param_names: "url parent_url element_type element_id content_type content uuid".split(" ")
        },
        CONTENTUNLOAD: {
            authorized_param_names: "url parent_url element_type element_id content_type content uuid".split(" ")
        },
        INVITATION: {
            authorized_param_names: ["email"]
        },
        SHARE: {
            authorized_param_names: ["recipe_id", "shared_to", "sharing_method"]
        },
        OPTIN_NEWS: {
            authorized_param_names: ["optin_value"]
        },
        OPTIN_NEWSLETTER: {
            authorized_param_names: ["optin_value"]
        }
    };
    Date.prototype.toISOString || function() {
        function a(a) {
            a = String(a);
            1 === a.length && (a = "0" + a);
            return a
        }
        Date.prototype.toISOString = function() {
            return this.getUTCFullYear() + "-" + a(this.getUTCMonth() + 1) + "-" + a(this.getUTCDate()) + "T" + a(this.getUTCHours()) + ":" + a(this.getUTCMinutes()) + ":" + a(this.getUTCSeconds()) + "." + String((this.getUTCMilliseconds() / 1E3).toFixed(3)).slice(2, 5) + "Z"
        }
    }();
    d.init = function(a) {
        if (a.ssid && a.version)
            m.ssid = a.ssid,
            m.version = a.version,
            !1 === a.async && (f.async = !1),
            a.geoloc && (f.geoloc = !0),
            a.element_type && (f.element_type = a.element_type),
            a.element_id && (f.element_id = a.element_id),
            !0 === a.devMode && (f.devMode = !0),
            !0 === a.followDoNotTrackPolicy && (f.followDoNotTrackPolicy = !0),
            a.timeBetweenTries && !isNaN(parseInt(a.timeBetweenTries)) && (f.timeBetweenTries = a.timeBetweenTries),
            s = !0,
            d.willTrack() && (m.context = G(),
            y.start(),
            t = new H),
            f.devMode && (console.info("You use sebAnalytics js lib version: " + d.version() + "\n"),
            d.willTrack() ? (d.removeAllEvents = function() {
                return t.removeAllEvents()
            }
            ,
            d.queuedEvent = function() {
                return t.queuedEvent()
            }
            ,
            d.getOptionalParameters = function() {
                console.log(f)
            }
            ) : console.info("SEB analytics is configured to not track event."));
        else
            return console.error(h.babInitParams, "    at sebAna.init(datas)"),
            !1
    }
    ;
    d.willTrack = function() {
        return !f.followDoNotTrackPolicy || 1 != window.navigator.doNotTrack
    }
    ;
    d.addEvent = function(a) {
        if (s) {
            if (d.willTrack()) {
                for (var b in a)
                    if (b in ["type"] ? a[b] || console.error(h.invalidEvent, "    at sanitize event\n", '    [GRAVE] Event key "' + b + '" has a bad value\n') : "date" === b && (a[b] ? a.date.match(/(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+)|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d)|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d)/) && !isNaN(new Date(a.date)) || console.error(h.invalidEvent, "    at sanitize event\n", "    [GRAVE] Event date is an invalid date or is not in iso format\n") : a.date = (new Date).toISOString()),
                    "params" === b)
                        for (var c = a.params.length - 1; 0 <= c; c--) {
                            var e = a.params[c];
                            e && e.name ? void 0 === e.value && (e.value = null) : a.params.splice(c, 1)
                        }
                a.guid = u();
                t.push(a)
            }
        } else
            console.error(h.notInitialized, "    at sebAna.addEvent(event)\n")
    }
    ;
    d.buildAndAddMappedEvent = function(a, b, c) {
        if (s) {
            if (!(a in w))
                return console.error(h.badEventId, "    at sebAna.buildAndAddEvent(eventId, values)\n"),
                !1;
            var e = w[a];
            if ("[object Array]" !== Object.prototype.toString.call(b) || b.length !== e.authorized_param_names.length)
                return console.error(h.badValuesEvent, "    at sebAna.buildAndAddEvent(eventId, values)\n", "values length: " + b.length + ", eventMap.authorized_param_names: " + e.authorized_param_names.length + "\n"),
                !1;
            var f = [], g;
            for (g in e.authorized_param_names)
                f.push(d.getParam(e.authorized_param_names[g], b[g]));
            d.buildAndAddEvent(a, f, c);
            return !0
        }
        console.error(h.notInitialized, "    at sebAna.buildAndAddMappedEvent(eventId, params, customDate \n")
    }
    ;
    d.buildAndAddEvent = function(a, b, c) {
        if (s) {
            var e = d.getPreBuildEvent();
            e.type = a;
            c && "[object Array]" === Object.prototype.toString.call(values) ? e.date = c.toISOString() : c && (e.date = c);
            e.params = b;
            d.addEvent(e);
            return !0
        }
        console.error(h.notInitialized, "    at sebAna.buildAndAddEvent(eventId, params, customDate \n")
    }
    ;
    d.getPreBuildEvent = function() {
        if (s)
            return p(m);
        console.error(h.notInitialized, "    at sebAna.getPreBuildEvent(event)\n")
    }
    ;
    d.getParam = function(a, b) {
        if (s) {
            var c = a ? a : null
              , e = void 0 !== b ? b : null
              , d = p(L);
            d.name = c;
            d.value = e;
            return d
        }
        console.error(h.notInitialized, "    at sebAna.getPreBuildParam(event)\n")
    }
    ;
    d.setUserId = function(a) {
        m.user.userid = a
    }
    ;
    d.genGUID = u;
    d.version = function() {
        return m.libVersion
    }
    ;
    d.addLoadContent = function(a, b) {
        var c, e = p(a);
        c = w.CONTENTLOAD;
        if (e.length + 1 === c.authorized_param_names.length)
            c = u(),
            e.push(c);
        else if (e.length === c.authorized_param_names.length)
            c = e[e.length - 1];
        else
            return console.error(h.badValuesEvent, "    at sebAna.addLoadContent(values, customDate)", "values length: " + e.length + ", eventMap.authorized_param_names: " + c.authorized_param_names.length),
            !1;
        l[c] = e;
        d.buildAndAddMappedEvent("CONTENTLOAD", e, b);
        return c
    }
    ;
    d.unloadByGUID = function(a, b) {
        if (l[a]) {
            var c = l[a];
            delete l[a];
            d.buildAndAddMappedEvent("CONTENTUNLOAD", c, b);
            return !0
        }
        return !1
    }
    ;
    d.unloadCustom = function(a, b) {
        var c = p(a)
          , e = w.CONTENTUNLOAD;
        if (c.length !== e.authorized_param_names.length)
            return console.error(h.badValuesEvent, "    at sebAna.unloadCustom(values, customDate)", "values length: " + c.length + ", eventMap.authorized_param_names: " + e.authorized_param_names.length),
            !1;
        l[c[c.length - 1]] && delete l[c[c.length - 1]];
        d.buildAndAddMappedEvent("CONTENTUNLOAD", c, b);
        return !0
    }
    ;
    d.findLoadEventValues = function(a, b) {
        var c = -1, d = w.CONTENTLOAD, f;
        for (f in d.authorized_param_names)
            d.authorized_param_names[f] === a && (c = f);
        if (-1 === c)
            return [];
        var d = [], g;
        for (g in l)
            f = l[g],
            f[c] === b && d.push(p(f));
        return d
    }
    ;
    window.__sebAnalytics = d;
    var y = new function() {
        var a = this
          , b = !1
          , c = -1
          , e = d.configuration.timerDefault
          , f = function() {
            t.getQueueLength() ? t.shift() : (clearInterval(c),
            c = -1)
        };
        this.notifyTimer = function() {
            -1 == c && b && (c = setInterval(f, e))
        }
        ;
        a.start = function() {
            b = !0;
            a.notifyTimer()
        }
        ;
        a.stop = function() {
            b = !1;
            clearInterval(c);
            c = -1
        }
        ;
        a.wait = function(b) {
            a.stop();
            setTimeout(function() {
                a.start()
            }, b)
        }
    }
    ;
    return d
}();
